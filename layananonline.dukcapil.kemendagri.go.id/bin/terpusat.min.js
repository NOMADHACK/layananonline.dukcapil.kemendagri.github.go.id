"use strict";var integrasi_terpusat=(()=>{const t=SiakClient.getUrlServer()+"Terpusat/apps/generateCaptcha";let e=()=>{let e=(t,e)=>{mUtil.isDesktopDevice()&&t.maxlength({threshold:e,warningClass:"m-badge m-badge--warning m-badge--rounded m-badge--wide",limitReachedClass:"m-badge m-badge--success m-badge--rounded m-badge--wide"}),(t=>{SiakClient.dynamicKnownValidation(t,"required",!0,"CAPTCHA harus diisi").remove(),SiakClient.dynamicKnownValidation(t,"required",!0,"CAPTCHA harus diisi").add(),SiakClient.dynamicKnownValidation(t,"minlength",t.attr("maxlength"),"CAPTCHA kurang dari {0} karakter").remove(),SiakClient.dynamicKnownValidation(t,"minlength",t.attr("maxlength"),"CAPTCHA kurang dari {0} karakter").add()})(t)};return{init:a=>{let i=$(".captchaInputContainer",a);i.length&&i.each(((a,i)=>{(a=>{let i=$('input.captchaInput[type="text"]',a),n=$("img.captchaImage",a),l=$('input.captchaValidator[type="hidden"]',a);$("button.captchaRefresh",a).on("click",(r=>{r.preventDefault(),r.stopPropagation(),r.stopImmediatePropagation();let o=$(r.currentTarget);SiakClient.loading_block(),i.val(""),i.focus(),$.ajax({url:t+"?_="+SiakClient.uuidv4()+"-"+(new Date).getTime(),type:"get",contentType:"application/json; charset=utf-8",dataType:"json",cache:!1,success:function(t,r){let o="data:image/"+t.captchaMime+";base64, "+t.captchaImg;n.removeAttr("src").attr("src",o),SiakClient.loading_unblock(),i.removeAttr("maxlength").attr("maxlength",t.captchaLength),e(i,t.captchaLength),l.val($.trim(t.captchaValidator)),SiakClient.initInputmask(a)},error:function(t){SiakClient.loading_unblock(),o.click()}})})).click()})($(i))}))}}},a=()=>({init:t=>{let e=$("div#pdf_preview-container",t);if(e.length){let i=$("iframe#FILENAME",e),n=$.trim(e.data("url-dokumen")),l=$.trim(e.data("path")),r=SiakClient.getUrlServer()+"Terpusat/Cetak/"+l+"/procGetFile?file="+n;e.data("baseurl",r);let o=encodeURIComponent(r);if("undefined"!=typeof PDFObject)if(PDFObject.supportsPDFs){var a=new XMLHttpRequest;a.open("GET",r,!0),a.responseType="arraybuffer",a.onload=function(t){if(200==this.status){let t=new Blob([this.response],{type:"application/pdf"}),a=URL.createObjectURL(t),n={};n={id:i.attr("id"),pdfOpenParams:{navpanes:0,toolbar:0,statusbar:0,view:"FitH",zoom:100},forceIframe:!0,PDFJS_URL:"/minduk/plugins/pdfjs/web/preview_cetak_integrasi.html"};var e=i.closest(".m-section__content");PDFObject.embed(a,e,n)}},a.send()}else i.attr("src","/minduk/plugins/pdfjs/web/preview_cetak_integrasi.html?file="+o);else i.attr("src","/minduk/plugins/pdfjs/web/preview_cetak_integrasi.html?file="+o);let s=$("button#docetak",t);s.length&&s.on("click",(t=>{t.stopPropagation(),t.stopImmediatePropagation(),printJS({printable:r,type:"pdf",showModal:!0})}))}}});return{init:()=>{$("body").removeClass("m-page--loading"),SiakClient.loading_block(),SiakClient.initPublicAccess().then((()=>{(()=>{let t=$("ul.my-info",$("#SIAKPage"));SiakClient.appStaging().then((e=>{if(t.length){let a=$(".my-info-ip",t);a.length&&a.text(e.ip_client);let i=$(".my-info-version",t);i.length&&i.text(e.semantic);let n=$("li.my-info-stage",t);if(n.length){let t=$("a",n),a=$("i",t);if(""!==e.state){let i="la la-puzzle-piece m-animate-blink";"development"===e.state.toLowerCase()&&(i="la la-code-fork m-animate-blink"),a.addClass(i),t.removeData("original-title").data("original-title",e.state),t.removeData("toggle").data("toggle","m-tooltip"),t.removeData("placement").data("placement","left")}else a.addClass("la la-diamond"),t.removeData("original-title").removeData("toggle").removeData("placement")}t.removeClass("m--hide")}})).catch((t=>{container.empty(),container.addClass("m--hide")}))})()}))},initPindai:()=>{let t=$("#SIAKPage"),a=$("form#form_terpusat_pindai",t);a.length&&($("body").on("contextmenu",(t=>(t.preventDefault(),!1))),(t=>{let e,a=$.trim(new URL(location).pathname);a=a.substr("/Terpusat/Pindai/".length),e=a.endsWith("/")?a.substr(0,a.length-1):a,$('input#inKey[type="hidden"]',t).val(e)})(a),$('input#CAPTCHA[type="text"]',a).val(""),e().init(a),$("button.captchaRefresh",a).length&&a.on("ajaxErrorExtendedHandler",(t=>{t.stopPropagation(),t.stopImmediatePropagation(),$("button.captchaRefresh",a).click()})))},initProcDataPindai:()=>{let t=$("#SIAKPage"),e=$("div#siakContentHandlebar",t);$(".sembunyikan",e).length>0&&$(".sembunyikan",e).each(((t,e)=>{let a=$(e),i=$.trim(a.text());i.length>0&&(i=i.substr(0,i.length-3),a.html(i+'<span class="m--font-info">***</span>'),a.addClass("font-ocra m--regular-font-size-lg1 m--font-boldest"),a.removeClass("m--hide"))}))},initCetak:()=>{let t=$("#SIAKPage"),a=$("form#form_terpusat_cetak",t);a.length&&((t=>{let e=new URL(location);void 0!==e.hash&&""!==e.hash&&$('input#PIN[type="text"]',t).val(e.hash.substring(1))})(a),$('input#CAPTCHA[type="text"]',a).val(""),e().init(a),$("button.captchaRefresh",a).length&&a.on("ajaxErrorExtendedHandler",(t=>{t.stopPropagation(),t.stopImmediatePropagation(),$("button.captchaRefresh",a).click()})))},initProcDataCetak:()=>{let t=$("#SIAKPage"),e=$("div#siakContentHandlebar",t);a().init(e)},initProcDataCetakImage:()=>{let t=$("#SIAKPage"),e=$("div#siakContentHandlebar",t);(()=>{let t=t=>{let e=$("button.docetak, a.docetak",t);return{toggleOn:(t,a)=>{e.length&&e.each(((e,i)=>{$(i).on("click",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let i=$(e.currentTarget),n=SiakClient.getUrlServer()+"Terpusat/Cetak/"+a+"/procGetFile?_="+SiakClient.uuidv4()+"-"+(new Date).getTime();SiakClient.loading_block(),$.ajax({method:"GET",url:n,contentType:"application/json",async:!1,crossDomain:!0,headers:{"token-siak":t},success:function(t,e){SiakClient.loading_unblock(),printJS({printable:$.trim(t.data),type:"pdf",base64:!0,showModal:!0})},error:function(t){SiakClient.loading_unblock();let e="Terjadi kesalahan";t.getResponseHeader("content-type").indexOf("application/json")>=0&&t.responseJSON&&void 0!==t.responseJSON.message&&(e=t.responseJSON.message),SiakClient.peringatan(e,i)}})}))}))},toggleOff:()=>{e.length&&e.each(((t,e)=>{$(e).off("click")}))}}},e=(t,e)=>{let a=$("button.lightgalery-toggler, a.lightgalery-toggler",t);if(a.length){let t=$.trim(e.data("lg-src")),i='<h1 class="font-ocra">'+$.trim(e.data("lg-caption-title"))+'</h1><p class="m--regular-font-size-lg3" style="word-break: break-word;">Pratinjau salinan dokumen.</p>';a.each(((e,a)=>{$(a).off("click").on("click",(e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let a=$(e.currentTarget);lightGallery(a.get(0),{dynamic:!0,dynamicEl:[{src:t,subHtml:i}],download:!1,closable:!1,zoom:!0,rotate:!0})}))}))}};return{init:a=>{let i=$("div#pdf_preview-container",a);if(i.length){SiakClient.loading_block();let n=$("div#FILENAME",i),l=$("img",n),r=SiakClient.getUrlServer()+"minduk/img/img-not-found.png",o=$.trim(i.data("url-dokumen")),s=$.trim(i.data("path")),c=SiakClient.getUrlServer()+"Terpusat/Cetak/"+s+"/procGetFileImage?file="+o;i.data("baseurl",c),$.ajax({method:"GET",url:c,contentType:"application/json",async:!1,crossDomain:!0,success:function(r,o){SiakClient.loading_unblock(),l.removeAttr("src").attr("src",r.IMG_SRC[2]),l.removeData("lg-src").data("lg-src",r.IMG_SRC[2]),e(a,l),mApp.initScroller(n,{},!1);let c=$.trim(i.data("url-dokumen-ctk"));t(a).toggleOn(c,s)},error:function(i){SiakClient.loading_unblock(),l.removeAttr("src").attr("src",r),l.removeData("lg-src").data("lg-src",r),e(a,l),mApp.initScroller(n,{},!1),t(a).toggleOff()}})}}}})().init(e)}}})();$(document).ready((function(){integrasi_terpusat.init()}));